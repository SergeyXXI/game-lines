!function(){"use strict";var e,t,n,r,o,a,i,c,l,f,s,d,u,m=function(){return new Array(9).fill(0).map((function(e){return new Array(9).fill(0)}))},g=function(){e=m(),t=m(),n=function(){for(var e=[],t=0,n=0;n<89;n++)e[t]=n,t++,n%10==8&&n++;return e}(),o=!1,r=[[],[]],a=0},v=function(t,o,i){for(var c=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e){var c=n.indexOf(10*t+o);n[c]=n[0],n.shift(),r&&n.push(10*a+i)}else n.push(10*t+o)},l=arguments.length,f=new Array(l>3?l-3:0),s=3;s<l;s++)f[s-3]=arguments[s];switch(i){case"add":var d=f[0],u=f[1];e[t][o]=d,c(),r[0][u]=t,r[1][u]=o,a++;break;case"move":var m=f[0],g=f[1];d=f[2],e[t][o]=d,e[m][g]=0,c(!0,!0,m,g);break;case"delete":e[t][o]=0,c(!1),a--}},b=function(t){var n,o,a,i=t-1;return n=r[0][i],o=r[1][i],a=e[n][o],e[n][o]>0?h(n,o,a):{state:!1}},h=function(t,n,r){for(var o=0,a=t,i=n,c=[[],[]],l=function(e){switch(c[0][o]=a,c[1][o]=i,o++,e){case"left":a--;break;case"right":a++;break;case"top":i--;break;case"bottom":i++;break;case"left-bottom":a--,i++;break;case"left-top":a--,i--;break;case"right-bottom":a++,i++;break;case"right-top":a++,i--}},f=function(){if(5==o){for(o=0;o<5;o++)a=c[0][o],i=c[1][o],v(a,i,"delete");return!0}return!1};o<5&&a>=0&&e[a][i]==r;)l("left");for(a=t+1;o<5&&a<9&&e[a][i]==r;)l("right");if(f())return{state:!0,delbuf:c,color:r};for(o=0,a=t;o<5&&i>=0&&e[a][i]==r;)l("top");for(i=n+1;o<5&&i<9&&e[a][i]==r;)l("bottom");if(f())return{state:!0,delbuf:c,color:r};for(o=0,i=n;o<5&&a>=0&&i>=0&&e[a][i]==r;)l("left-top");for(a=t+1,i=n+1;o<5&&a<9&&i<9&&e[a][i]==r;)l("right-bottom");if(f())return{state:!0,delbuf:c,color:r};for(o=0,a=t,i=n;o<5&&a<9&&i>=0&&e[a][i]==r;)l("right-top");for(a=t-1,i=n+1;o<5&&a>=0&&i<9&&e[a][i]==r;)l("left-bottom");return f()?{state:!0,delbuf:c,color:r}:{state:!1}},p=document.getElementById("canvas"),w=p.getContext("2d"),I=document.getElementById("container"),k=document.getElementById("interface__button"),_=k.querySelector("img"),y=document.getElementById("interface__score-field"),E=document.getElementById("record"),L=new Image,M=new Image,T=new Image,x=new Image,A=40,B=39,S=45,R=3,j=0,q=function(e){for(var t,r,o,i,c=0;c<e&&81!=a;c++)i=n[Math.floor(Math.random()*n.length)],t=Math.floor(i/10),r=i%10,o=Math.floor(7*Math.random())+1,w.drawImage(M,0,A*(o-1),A,B,4+S*t,8+S*r,A,B),v(t,r,"add",o,c);return c},O=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];I.style.position="relative";var a=document.createElement("div"),i=document.createElement("div"),c=document.createElement("div");a.id="msg-box",i.id="wrapper",i.classList.add("animate__animated",n),o&&(e+="<br><span style='color: #0066cb'>Вы обновили свой рекорд!</span>"),c.innerHTML=e,i.append(c),a.append(i),I.append(a),setTimeout((function(){i.classList.add(r),i.addEventListener("animationend",(function(){a.remove(),I.style.position=""}))}),t)},C=function(e){if(e.state)return H(e.delbuf,e.color),R=0,j+=10,y.innerText=j,!0},D=function(e,t,n){clearInterval(i),w.clearRect(4+S*e,8+S*t,A,B),w.drawImage(M,0,A*(n-1),A,B,4+S*e,8+S*t,A,B)},H=function(e,t){var n,r,o=0;!function a(){n=e[0][o],r=e[1][o],N(n,r,t),++o<5&&setTimeout(a,50)}()},N=function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;w.drawImage(x,A*o,A*(r-1),A,B,4+S*t,8+S*n,A,B),++o<10?setTimeout(e,80,t,n,r,o):w.fillRect(4+S*t,8+S*n,A,B)};g(),p.width=407,p.height=414,(c=+localStorage.getItem("record"))||(localStorage.setItem("record","0"),c=0),E.insertAdjacentText("beforeend","".concat(c)),L.src="img/board.png",L.onload=function(){w.drawImage(L,0,0),M.src="img/balls.png",M.onload=function(){return q(5)}},T.src="img/jumpballs.png",x.src="img/outballs.png",k.addEventListener("click",(function(){_.classList.add("refreshing"),clearInterval(i),g(),w.clearRect(0,0,p.width,p.height),j=0,y.innerText=j,R=3,w.drawImage(L,0,0),q(5)})),_.addEventListener("transitionend",(function(){return _.classList.remove("refreshing")})),u=1,w.fillStyle="#c5c5c5",p.addEventListener("pointerdown",(function(n){var r,m=n.pageX-p.offsetLeft,g=n.pageY-p.offsetTop,I=Math.floor(m/45),k=Math.floor(g/45),_=function(n,r,a,i){var c;return n>8||n<0||r>8||r<0?null:!o&&e[n][r]>0?(c=e[n][r],o=!0,{msg:"ball is chosen",color:c}):o&&n==a&&r==i?null:o&&e[n][r]>0?{msg:"another ball is chosen",color:c=e[n][r]}:o&&0==e[n][r]?function(n,r,o,a){var i,c=e[o][a],l=!0,f=!1;(t=function(t){for(var n,r,o=0;o<81;o++)r=o%9,t[n=Math.floor(o/9)][r]=e[n][r];return t}(t))[n][r]=1e3,t[o][a]=10,i=t[o][a];for(var s=function(e,s){0==t[e][s]?(f=!0,t[e][s]=i+10):1e3==t[e][s]&&(v(n,r,"move",o,a,c),l=!1,f=!0)};l;){for(var d=0;d<81;d++){var u=d%9,m=Math.floor(d/9);if(t[u][m]==i){if(m-1>=0&&(s(u,m-1),!l))break;if(u+1<=8&&(s(u+1,m),!l))break;if(m+1<=8&&(s(u,m+1),!l))break;if(u-1>=0&&(s(u-1,m),!l))break}}if(0==f)break;l&&(f=!1),i+=10}return f}(n,r,a,i)?(o=!1,{msg:"ball is moved",color:c}):{msg:"wrong square"}:void 0}(I,k,f,s)||{msg:"no handler"},y=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&D(f,s,l),f=I,s=k,l=_.color,i=setInterval((function(){w.drawImage(T,A*u,A*(l-1),A,B,4+S*I,8+S*k,A,B),6==++u&&(u=0)}),60)};switch(_.msg){case"ball is chosen":y();break;case"another ball is chosen":y(!0);break;case"ball is moved":r=0,D(f,s,l),w.fillRect(4+S*f,8+S*s,A,B),w.drawImage(M,0,A*(l-1),A,B,4+S*I,8+S*k,A,B),C(h(I,k,l))&&(r=1e3),setTimeout((function(){for(3!=R&&R++,d=q(R);d>0;)C(b(d)),d--;!function(){if(81==a){var e=!1;j>c&&(e=!0,c=j,localStorage.setItem("record",c),E.childNodes[1].remove(),E.insertAdjacentText("beforeend","".concat(c))),O("Игра завершена!",2500,"animate__bounceInDown","animate__rollOut",e)}}()}),r);break;case"wrong square":O("Недопустимый ход!",1e3,"animate__bounceIn","animate__bounceOut")}}))}();